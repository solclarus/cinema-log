# CinemaLog 機能仕様書

## アプリ概要

### 基本情報
- **アプリ名**: CinemaLog
- **対象プラットフォーム**: iOS 16.0+
- **主要機能**: 映画鑑賞記録管理・統計表示・ウォッチリスト

## 詳細機能仕様

### 1. 映画発見機能 (DiscoverView)

#### 1.1 タブ構成
```
├── 人気の映画 (Popular Movies)
├── 今見れる (Available Now) - ストリーミングフィルター
└── ウォッチリスト (Watchlist)
```

#### 1.2 人気の映画タブ
- **データソース**: TMDB Popular Movies API
- **表示形式**: グリッド表示（2列）
- **情報表示**: ポスター、タイトル、公開年、評価
- **インタラクション**: タップで詳細画面遷移
- **ページング**: 無限スクロール対応

#### 1.3 今見れるタブ
- **フィルター条件**: ユーザー選択ストリーミングサービス
- **データソース**: TMDB Watch Providers API
- **表示形式**: 人気映画タブと同様
- **設定連携**: ストリーミングサービス設定と連動

#### 1.4 ウォッチリストタブ
- **データソース**: ローカル SwiftData
- **表示形式**: リスト表示
- **並び順**: 優先度 → 追加日時
- **フィルター**: 優先度フィルター（全て/高/中/低）
- **操作**: スワイプで削除、タップで詳細

#### 1.5 映画検索機能
- **検索方式**: リアルタイム検索
- **データソース**: TMDB Search API
- **検索対象**: 映画タイトル（日本語・英語対応）
- **結果表示**: 検索結果リスト
- **空状態**: 「検索結果が見つかりません」

### 2. 鑑賞記録機能 (RecordsView)

#### 2.1 表示モード
```
├── カレンダー表示
├── リスト表示
└── ポスター表示
```

#### 2.2 カレンダー表示
- **カレンダー形式**: 月間カレンダー
- **記録表示**: 日付にドット表示
- **ヒートマップ**: 鑑賞数に応じた色の濃淡
- **詳細表示**: 日付タップで当日の記録一覧
- **ナビゲーション**: 月間移動可能

#### 2.3 リスト表示
- **並び順**: 鑑賞日時降順（最新が上）
- **表示項目**: 
  - ポスター画像（小）
  - 映画タイトル
  - 鑑賞日
  - 評価（星表示）
  - 再鑑賞バッジ
- **操作**: タップで詳細、スワイプで削除

#### 2.4 ポスター表示
- **表示形式**: ポスターグリッド（3列）
- **並び順**: 鑑賞日時降順
- **オーバーレイ**: 評価星とタイトル
- **操作**: タップで詳細表示

#### 2.5 鑑賞記録追加・編集
- **必須項目**: 映画、鑑賞日、評価（1-5星）
- **オプション項目**: 
  - メモ・感想
  - 鑑賞場所
  - 同伴者
  - 鑑賞回数（自動計算 + 手動調整可能）
- **再鑑賞判定**: 同一映画の過去記録を自動チェック

### 3. 統計機能 (StatisticsView)

#### 3.1 概要セクション
- **総鑑賞数**: 全期間の鑑賞記録数
- **今月鑑賞数**: 当月の鑑賞数
- **平均評価**: 全記録の評価平均値
- **再鑑賞率**: （再鑑賞数 / 総鑑賞数）× 100

#### 3.2 期間別統計
- **月別鑑賞数グラフ**: 過去12ヶ月の棒グラフ
- **年別鑑賞数**: 年間比較
- **最も活発な月**: 最大鑑賞数の月
- **月平均**: 月間平均鑑賞数

#### 3.3 ジャンル統計
- **上位ジャンル**: 鑑賞数上位5ジャンル
- **ジャンル別平均評価**: ジャンルごとの評価平均
- **ジャンル分布**: 円グラフ表示

#### 3.4 評価分布
- **評価別件数**: 1-5星の分布
- **評価分布グラフ**: 棒グラフ表示
- **評価傾向**: 高評価/低評価の傾向

#### 3.5 鑑賞ランキング
- **最も観た映画**: 鑑賞回数上位
- **高評価映画**: 評価5星の映画一覧
- **最近のお気に入り**: 直近3ヶ月の高評価映画

### 4. 設定機能 (SettingsView)

#### 4.1 言語設定
- **対応言語**: 日本語・英語
- **設定保存**: UserDefaults
- **即座反映**: アプリ再起動不要

#### 4.2 ストリーミングサービス設定
- **事前定義サービス**: Netflix, Amazon Prime Video, Disney+等
- **有効/無効切り替え**: トグルスイッチ
- **今見れるタブ連携**: 選択サービスでフィルタリング

#### 4.3 データ管理
- **iCloudバックアップ**: CloudKit同期設定
- **データ件数表示**: 映画数・記録数
- **サンプルデータ**: 開発・デモ用データ追加
- **全データ削除**: 確認ダイアログ付き

#### 4.4 通知設定
- **鑑賞記録リマインダー**: 定期的な記録促進通知
- **新作通知**: ウォッチリスト映画の新作情報
- **統計レポート**: 月間統計サマリー通知

#### 4.5 アプリ情報
- **バージョン情報**: アプリバージョン表示
- **開発者情報**: 開発者クレジット
- **利用規約・プライバシーポリシー**: リンク表示

### 5. 映画詳細機能

#### 5.1 TMDB映画詳細 (TMDBMovieDetailView)
- **基本情報**: タイトル、公開年、ジャンル、概要
- **ビジュアル**: ポスター画像、背景画像
- **詳細情報**: キャスト、監督、上映時間、評価
- **アクション**: 
  - 鑑賞記録追加
  - ウォッチリスト追加/削除
- **ストリーミング情報**: 視聴可能サービス表示

#### 5.2 登録済み映画詳細 (MovieDetailView)
- **基本情報**: TMDBと同様
- **鑑賞履歴**: 過去の鑑賞記録一覧
- **統計情報**: 鑑賞回数、平均評価、最後の鑑賞日
- **アクション**: 
  - 新しい鑑賞記録追加
  - 過去記録の編集・削除

#### 5.3 鑑賞記録詳細 (ViewingRecordDetailView)
- **詳細情報**: 全ての記録項目表示
- **編集機能**: 全項目編集可能
- **削除機能**: 確認ダイアログ付き削除
- **映画情報**: 関連映画情報表示

### 6. ウォッチリスト機能

#### 6.1 ウォッチリスト管理
- **優先度設定**: 高・中・低の3段階
- **メモ機能**: 見たい理由等のメモ
- **並び替え**: 優先度 → 追加日順
- **フィルタリング**: 優先度別フィルター

#### 6.2 ウォッチリスト操作
- **追加**: 映画詳細画面から追加
- **削除**: スワイプ削除またはボタン削除
- **記録移行**: ウォッチリストから鑑賞記録へ直接移行
- **一括操作**: 複数選択での一括削除

### 7. 共通コンポーネント

#### 7.1 AsyncPosterImage
- **画像読み込み**: 非同期ポスター画像表示
- **プレースホルダー**: 読み込み中・エラー時の代替表示
- **キャッシュ**: 自動画像キャッシュ

#### 7.2 評価表示
- **星評価**: 1-5星の視覚的表示
- **編集可能**: タップで評価変更
- **無評価状態**: 未評価時の表示

#### 7.3 検索機能
- **リアルタイム検索**: 入力中のライブ検索
- **検索履歴**: 過去の検索クエリ保存
- **検索候補**: 入力補完機能

## データフロー

### 映画追加フロー
```
TMDB検索 → 映画選択 → 詳細確認 → 鑑賞記録作成 → SwiftData保存
```

### ウォッチリスト追加フロー
```
映画詳細画面 → ウォッチリスト追加ボタン → 優先度選択 → 保存
```

### 統計計算フロー
```
SwiftData読み込み → データ集計 → グラフ・表示用データ変換 → UI更新
```

## エラーハンドリング

### ネットワークエラー
- **API接続失敗**: リトライボタン付きエラー表示
- **タイムアウト**: 再試行案内
- **レート制限**: 一時的な利用制限通知

### データエラー
- **保存失敗**: エラーメッセージとリトライ
- **読み込み失敗**: データ復旧案内
- **不整合データ**: 自動修復またはリセット案内

### ユーザーエラー
- **必須項目未入力**: リアルタイムバリデーション
- **無効な日付**: 入力制限とエラー表示
- **重複データ**: 確認ダイアログ

## パフォーマンス要件

### 応答性能
- **画面遷移**: 300ms以内
- **API応答**: 2秒以内でローディング表示
- **リスト表示**: LazyVStack使用で軽量化

### メモリ使用量
- **画像キャッシュ**: 適切なサイズ制限
- **データベース**: 効率的なクエリ使用
- **バックグラウンド処理**: 適切なライフサイクル管理

## アクセシビリティ

### VoiceOver対応
- **すべてのUI要素**: 適切なラベル設定
- **ナビゲーション**: 論理的な読み上げ順序
- **操作案内**: 操作方法の音声案内

### 視覚的配慮
- **コントラスト**: WCAG準拠の色彩設計
- **フォントサイズ**: Dynamic Type対応
- **カラーバリアフリー**: 色のみに依存しない設計

この仕様書に基づいて実装することで、ユーザーフレンドリーで機能豊富な映画鑑賞記録アプリを構築できます。
